<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realidad Aumentada B√°sica</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@2.2.2/aframe/build/aframe-ar.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #000;
        }
        
        #info {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
            font-size: 14px;
        }
        
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            margin: 10px 5px;
            font-size: 16px;
            cursor: pointer;
        }
        
        button:active {
            background: #0056CC;
        }
        
        .hidden {
            display: none !important;
        }
        
        #marker-link {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 100, 200, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            z-index: 999;
        }
        
        #marker-link a {
            color: #FFD700;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Panel de informaci√≥n -->
    <div id="info">
        <h3>üéØ AR con Marcador Hiro</h3>
        <p id="status">Presiona para activar la c√°mara</p>
        <button onclick="startCamera()">üì∑ Iniciar C√°mara</button>
    </div>
    
    <!-- Enlace al marcador -->
    <div id="marker-link" class="hidden">
        <strong>üìÑ Necesitas el marcador Hiro</strong><br>
        <a href="https://ar-js-org.github.io/AR.js/data/images/hiro.png" target="_blank">
            üëÜ Toca aqu√≠ para descargar el marcador
        </a><br>
        <small>Gu√°rdalo en tu tel√©fono o impr√≠melo</small>
    </div>

    <!-- Escena AR -->
    <a-scene 
        id="scene"
        class="hidden"
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false;"
        renderer="logarithmicDepthBuffer: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">
        
        <!-- Marcador Hiro -->
        <a-marker preset="hiro" id="hiro-marker">
            <!-- Cubo azul principal -->
            <a-box 
                position="0 0.5 0" 
                material="color: blue; opacity: 0.8"
                scale="1 1 1"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 4000">
            </a-box>
            
            <!-- Esfera roja orbitando -->
            <a-sphere 
                position="2 0.5 0" 
                material="color: red; opacity: 0.9"
                scale="0.4 0.4 0.4"
                animation="property: position; to: -2 0.5 0; loop: true; dur: 3000; dir: alternate">
            </a-sphere>
            
            <!-- Texto -->
            <a-text 
                value="¬°FUNCIONA!" 
                position="0 2 0" 
                align="center" 
                color="white"
                scale="1.5 1.5 1.5">
            </a-text>
        </a-marker>

        <!-- C√°mara -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let cameraActive = false;
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            console.log(message);
        }
        
        function startCamera() {
            if (cameraActive) return;
            
            updateStatus('Solicitando acceso a la c√°mara...');
            
            // Verificar soporte
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                updateStatus('‚ùå Tu navegador no soporta acceso a c√°mara');
                return;
            }
            
            // Solicitar c√°mara
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment'
                } 
            })
            .then(function(stream) {
                console.log('‚úÖ C√°mara accesible');
                updateStatus('‚úÖ C√°mara activada - Apunta al marcador');
                cameraActive = true;
                
                // Parar el stream de prueba
                stream.getTracks().forEach(track => track.stop());
                
                // Mostrar la escena AR
                document.getElementById('info').style.background = 'rgba(0, 150, 0, 0.8)';
                document.getElementById('scene').classList.remove('hidden');
                document.getElementById('marker-link').classList.remove('hidden');
                
                // Configurar eventos del marcador
                setupMarkerEvents();
            })
            .catch(function(error) {
                console.error('Error de c√°mara:', error);
                handleCameraError(error);
            });
        }
        
        function setupMarkerEvents() {
            const marker = document.getElementById('hiro-marker');
            
            marker.addEventListener('markerFound', function() {
                console.log('üéØ ¬°Marcador Hiro detectado!');
                updateStatus('üéØ ¬°Marcador detectado! Ver√°s el cubo azul');
                document.getElementById('marker-link').classList.add('hidden');
            });
            
            marker.addEventListener('markerLost', function() {
                console.log('‚ùå Marcador perdido');
                updateStatus('üîç Buscando marcador Hiro...');
                document.getElementById('marker-link').classList.remove('hidden');
            });
        }
        
        function handleCameraError(error) {
            let message = '';
            
            switch(error.name) {
                case 'NotAllowedError':
                    message = '‚ùå Permisos denegados. Ve a Configuraci√≥n ‚Üí Safari ‚Üí C√°mara';
                    break;
                case 'NotFoundError':
                    message = '‚ùå No se encontr√≥ c√°mara en tu dispositivo';
                    break;
                case 'NotSupportedError':
                    message = '‚ùå Tu navegador no soporta c√°mara (necesita HTTPS)';
                    break;
                default:
                    message = '‚ùå Error: ' + error.message;
            }
            
            updateStatus(message);
            document.getElementById('info').style.background = 'rgba(200, 0, 0, 0.8)';
        }
        
        // Verificar HTTPS al cargar
        window.addEventListener('load', function() {
            console.log('AR App cargada');
            console.log('Protocolo:', location.protocol);
            console.log('URL:', location.href);
            
            if (location.protocol === 'https:') {
                console.log('‚úÖ HTTPS activo');
                updateStatus('Listo - Presiona para activar c√°mara');
            } else {
                console.log('‚ö†Ô∏è HTTP detectado');
                updateStatus('‚ö†Ô∏è Se recomienda HTTPS para mejor funcionamiento');
            }
        });
    </script>
</body>
</html>
